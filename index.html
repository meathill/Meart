<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <title>Meart: a static site builder</title>

  <link rel="stylesheet" href="node_modules/tether/dist/css/tether.min.css">
  <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/screen.css">
</head>
<body>
<div id="app">
  <router-view></router-view>
</div>

<script type="text/x-template" id="home-template">
  <div id="home">
    <aside>
      <router-link to="/preview" class="btn btn-secondary btn-block" title="查看网站">
        <i class="fa fa-home"></i><br>
        查看网站
      </router-link>
      <router-link to="/articles" class="btn btn-secondary btn-block" title="相册">
        <i class="fa fa-photo"></i><br>
        相册
      </router-link>
      <router-link to="/config" class="btn btn-secondary btn-block" title="设置">
        <i class="fa fa-cogs"></i><br>
        设置
      </router-link>
      <router-link to="/help" class="btn btn-outline-secondary btn-block secondary" title="帮助"><i class="fa fa-question"></i></router-link>
    </aside>
    <router-view class="container-fluid">

    </router-view>
  </div>
</script>

<script type="text/x-template" id="welcome-template">
  <div class="welcome-panel col-sm-10 offset-sm-1 col-md-8 offset-md-2">
    <h2>欢迎使用 Meart</h2>
    <hr>
    <form class="carousel slide" data-ride="carousel" data-interval="0" data-keyboard="false" id="welcome-wizard" v-on:submit.prevent="onSubmit">
      <div class="carousel-inner" role="listbox">
        <div class="carousel-item active">
          <p class="lead">Meart 是一个免费工具，试图帮助设计师、摄影师快捷方便的创建个人作品网站。Meart 尽量将技术细节隐藏起来，所有过程均通过图形界面操作来实现。最终网站托管在免费 CDN 上。</p>
          <p>接下来，请跟随向导指引，完成网初始化。</p>
          <p class="t-a-c"><a href="#welcome-wizard" data-slide="next" role="button" class="btn btn-primary btn-lg carousel-control"><i class="fa fa-cog"></i> 开始</a></p>
        </div>
        <div class="carousel-item">
          <div class="form-group row">
            <label class="col-sm-2 col-form-label" for="site-title">网站名称</label>
            <div class="col-sm-10">
              <input class="form-control" name="site-title" id="site-title" placeholder="网站名称，比如“我的作品”" v-model="siteTitle">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label" for="site-desc">网站简介</label>
            <div class="col-sm-10">
              <textarea class="form-control" name="site-desc" id="site-desc" rows="3" placeholder="网站描述，在某些主题中会显示，主要用作被搜索时展示" v-model="siteDesc">

              </textarea>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label">网站图标</label>
            <div class="col-sm-10">
              <p class="help-block" v-if="siteIcon">
                <img class="rounded img-thumbnail" :src="siteIcon" width="80" height="80">
              </p>
              <input type="file" class="hide" id="site-icon" @change="onSelectFile">
              <label class="btn btn-secondary" for="site-icon">
                <i class="fa fa-picture-o"></i>
                选择图片（png，ico）
              </label>
              <p class="help-block text-muted"><small>(可选)</small></p>
            </div>
          </div>
          <div class="form-group t-a-r">
            <a href="#welcome-wizard" data-slide="next" role="button" class="btn btn-primary btn-lg carousel-control"><i class="fa fa-chevron-right"></i></a>
          </div>
        </div>
        <div class="carousel-item">
          <label>请选择模板：</label>
          <div class="form-group row theme-list">
            <div class="col-sm-4">
              <input type="radio" name="site-theme" value="default" id="theme-default" class="hide" v-model="siteTheme">
              <label class="card" for="theme-default">
                <img class="card-img-top" src="theme/default/img/thumbnail.svg" alt="默认主题">
                <div class="card-block">
                  <p class="card-text">默认主题。暂时只有这一个，未来会添加。</p>
                </div>
              </label>
            </div>
            <div class="col-sm-4">
              <input type="radio" name="site-theme" value="dark" id="theme-dark" class="hide" v-model="siteTheme">
              <label class="card" for="theme-dark">
                <img class="card-img-top" src="theme/dark/img/thumbnail.svg" alt="黑色主题">
                <div class="card-block">
                  <p class="card-text">黑色主题，内容较完整，建议选择。</p>
                </div>
              </label>
            </div>
          </div>
          <div class="form-group t-a-r">
            <button class="btn btn-primary btn-lg"><i class="fa fa-check"></i> 好了，开始吧</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</script>

<script type="text/x-template" id="preview-template">
  <div id="preview">
    <header>
      <h2>预览网站</h2>
      <p>上次生成时间：<time :datetime="publishTime | toDate" v-if="publishTime">{{publishTime | toMoment}}</time>
        <span class="badge badge-success" v-if="publishTime > lastModifiedTime"><i class="fa fa-check"></i> 最新</span>
        | 最近修改时间：<time :datetime="lastModifiedTime | toDate" v-if="lastModifiedTime">{{lastModifiedTime | toMoment}}</time>
      </p>
      <div class="button-group" role="group" aria-label="发布操作">
        <a href="#publish-modal" class="btn btn-primary" data-toggle="modal"><i class="fa fa-archive"></i> 发布网站</a>
        <a href="#upload-modal" class="btn btn-success" :data-toggle="hasUpload ? 'modal' : ''" :class="{disabled: !hasUpload}"><i class="fa fa-cloud-upload"></i> 上传到服务器</a>
      </div>
    </header>
    <nav class="navbar navbar-light bg-faded" v-if="publishTime">
      <form class="form-inline float-xs-left">
        <button type="button" class="btn btn-secondary btn-sm" @click="goBack"><i class="fa fa-chevron-left"></i></button>
        <button type="button" class="btn btn-secondary btn-sm" @click="refresh"><i class="fa fa-refresh"></i></button>
      </form>
    </nav>
    <iframe src="output/index.html" v-if="publishTime" :height="height"></iframe>
    <div class="alert alert-warning" v-else>
      <p>您还没有生成过网站页面，无法提供预览效果。</p>
      <a href="#publish-modal" class="btn btn-primary btn-lg" data-toggle="modal"><i class="fa fa-archive"></i> 立刻发布网站</a>
    </div>
  </div>
</script>

<script type="text/x-template" id="config-template">
  <div id="config">
    <h2>设置</h2>
    <hr>
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item">
        <a href="#site-config" class="nav-link active" data-toggle="tab" role="tab">
          <i class="fa fa-info-circle"></i> 网站信息
        </a>
      </li>
      <li class="nav-item">
        <a href="#site-server" class="nav-link" data-toggle="tab" role="tab">
          <i class="fa fa-server"></i> 服务器信息
        </a>
      </li>
    </ul>
    <div class="tab-content">
      <div id="site-config" class="tab-pane active"role="tabpanel">
        <div class="settings">
          <form>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="site-title">网点名称</label>
              <div class="col-sm-10">
                <input class="form-control" id="site-title" v-model="siteTitle">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="site-desc">网站简介</label>
              <div class="col-sm-10">
                <textarea class="form-control" id="site-desc" v-model="siteDesc" rows="2"></textarea>
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="site-icon">网站图标</label>
              <div class="col-sm-2">
                <img v-if="siteIcon" :src="siteIcon" class="img-thumbnail site-icon">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label">网站模板</label>
              <div class="col-sm-10">
                <div class="row theme-list">
                  <div class="col-sm-4" v-for="theme in themes">
                    <input type="radio" name="site-theme" class="hide" v-model="siteTheme" :value="theme.dir" :id="'theme-' + theme.dir">
                    <label class="card" :for="'theme-' + theme.dir">
                      <img class="card-img-top img-fluid" :src="'theme/' + theme.dir + '/' + theme.thumbnail" alt="默认模板" v-if="theme.thumbnail">
                      <div class="card-block">
                        <h4 class="card-title">{{theme.name}}</h4>
                        <p class="card-text">{{theme.description}}</p>
                      </div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div id="site-server" class="tab-pane" role="tabpanel">
        <form @submit.prevent="saveServerSettings" >
          <div class="form-group row">
            <label class="col-sm-2 col-form-label" for="server-name">服务器名称</label>
            <div class="col-sm-10">
              <select class="form-control" id="server-name" v-model="serverName">
                <option value="qiniu">七牛</option>
              </select>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label" for="ACCESS_KEY">Access Key</label>
            <div class="col-sm-10">
              <input type="password" class="form-control" id="access_key" v-model="serverACCESS_KEY">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label" for="SECRET_KEY">Secret Key</label>
            <div class="col-sm-10">
              <input type="password" class="form-control" id="secret_key" v-model="serverSECRET_KEY">
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-2 col-form-label" for="bucket">存放空间</label>
            <div class="col-sm-10">
              <input class="form-control" id="bucket" v-model="serverBucket">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="article-list-template">
  <div id="article-list" class="article-list article">
    <h2>相册</h2>
    <hr>
    <ul class="list row">
      <li v-for="article in isVisible(articles)" class="col-sm-4 single-article">
        <a :href="getHref(article.id)" class="card">
          <img class="card-img-top img-fluid" :src="article.thumbnail" :alt="article.title" v-if="article.thumbnail">
          <div class="card-block">
            <h4 class="card-title">{{article.title}}</h4>
            <p class="card-text">{{article.description}}</p>
            <small class="text-muted">创建时间：<time :datetime="article.createTime | toDate">{{article.createTime | toMoment}}</time></small><br>
            <small class="text-muted">最后修改：<time :datetime="article.lastModifiedTime | toDate">{{article.lastModifiedTime | toMoment}}</time></small>
          </div>
        </a>
      </li>
      <li class="article add col-sm-4">
        <button type="button" class="btn btn-success btn-block" v-on:click="add">
          <span class="fa-stack fa-lg">
            <i class="fa fa-picture-o fa-stack-2x fa-rotate-n-25"></i>
            <i class="fa fa-picture-o fa-stack-2x fa-rotate"></i>
            <i class="fa fa-plus-circle pbr"></i>
          </span>
          <br>
          <span class="caption">创建新相册</span>
        </button>
      </li>
    </ul>
  </div>
</script>

<script type="text/x-template" id="article-template">
  <article class="single article">
    <template>
      <header class="row">
        <div class="col-sm-3 thumbnail">
          <input type="file" class="hide" id="article-thumbnail" @change="onSelectThumbnail">
          <label for="article-thumbnail">
            <img :src="article.thumbnail | defaultValue('thumbnail')" class="img-thumbnail">
          </label>
        </div>
        <div class="col-sm-7">
          <editor :origin-value="article.title" @change="onEditorChange('title', $event)">
            <h1>{{article.title | defaultValue('title')}}</h1>
          </editor>
          <editor :origin-value="article.description" @change="onEditorChange('description', $event)">
            <p class="lead">{{article.description | defaultValue('description')}}</p>
          </editor>
          <editor :origin-value="article.url" @change="onEditorChange('url', $event)">
            <p>
              <u><small class="text-muted">http://您的网站/</small>{{article.url | defaultValue('url')}}<small class="text-muted">.html</small></u>
            </p>
          </editor>
          <p class="text-muted">
            <small>创建时间：<time :datetime="article.createTime | toDate">{{article.createTime | toMoment}}</time></small> |
            <small>修改时间：<time :datetime="article.lastModifiedTime | toDate">{{article.lastModifiedTime | toMoment}}</time></small>
          </p>
        </div>
        <div class="col-sm-2">
          <div class="form-group">
            <label for="draft">发布状态</label>
            <select v-model.number="status" id="draft" class="form-control fa" :class="publishedClass" :disabled="isNew">
              <option value="0" class="fa-check">&#xf00c 发布</option>
              <option value="1">草稿</option>
            </select>
          </div>
          <editor :origin-value="article.tags" @change="onEditorChange('tags', $event)">
            <p>{{article.tags | defaultValue('tags')}}</p>
          </editor>
        </div>
      </header>
      <hr>
      <ul class="row list album">
        <li v-for="(photo, index) in article.album" class="col-sm-4 photo" :class="{ active: photo.isActive }">
          <div class="card">
            <button type="button" class="btn btn-sm btn-secondary delete-button" @click="remove(index)">
              <i class="fa fa-trash"></i>
            </button>
            <img class="card-img-top img-fluid" :src="photo.src" :alt="photo.title" @load="onPhotoLoad($event, index)">
            <div class="card-block">
              <editor :origin-value="photo.title" @change="onPhotoChange('title', index, $event)">
                <h4 class="card-title">{{photo.title}}</h4>
              </editor>
              <editor :origin-value="photo.title" @change="onPhotoChange('description', index, $event)">
                <p class="card-text">{{photo.description}}</p>
              </editor>
            </div>
          </div>
        </li>
        <li class="col-sm-4 add">
          <label class="btn btn-secondary btn-block">
            <i class="fa fa-plus"></i>
            <input type="file" accept="image/*" @change="onSelectFile">
          </label>
        </li>
      </ul>
    </template>
  </article>
</script>

<script type="text/x-template" id="editor">
<div class="dbl-click-editor" v-bind:class="{ editing: isEditing }" @dblclick="edit">
  <slot></slot>
  <input class="form-control" v-model="value" @blur="editDone" @keyup.enter.prevent="editDone" @keyup.esc="cancel" autofocus>
</div>
</script>

<script type="text/x-template" id="help-template">
  <div id="help">
    <h2>帮助</h2>
    <hr>
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" role="tab" href="#help-detail">帮助</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" role="tab" href="#help-about">关于</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" role="tab" href="#help-author">作者</a>
      </li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="help-detail" role="tabpanel" v-html="tutorial">
      </div>
      <div class="tab-pane" id="help-about" role="tabpanel">
        <article v-html="about"></article>
        <h3>当前版本：</h3>
        <p>{{version}}</p>
      </div>
      <div class="tab-pane" id="help-author" role="tabpanel">
        <div class="row">
          <div class="col-sm-6">
            <h3>
              你好，我是 Meart 的开发者 Meathill
            </h3>
            <div class="card">
              <div class="card-block">
                <p>
                  <img :src="avatar" @click="easter" class="img-thumbnail card-img-top">
                </p>
                <p class="card-text">
                  我有不少设计师或者搞摄影的朋友，有一天我觉得做这样一款软件帮他们建站应该是个好主意。
                </p>
                <p class="card-text">
                  于是我就做了。
                </p>
                <p class="card-text">
                  感谢你来使用，欢迎反馈任何问题给我：
                </p>
                <a href="https://weibo.com/meathill" @click.prevent="openExternal"><i class="fa fa-weibo"></i> 我的微博</a> &nbsp;
                <a href="mailto:meathill@qq.com" @click.prevent="openExternal"><i class="fa fa-envelope"></i> 发邮件</a>
              </div>
            </div>
          </div>
          <div class="col-sm-6">
            <h3>请我喝杯咖啡吧</h3>
            <div class="row">
              <div class="col-sm-6">
                <div class="card">
                  <header class="card-header">
                    微信
                  </header>
                  <img src="img/weixin-qrcode.jpg" class="card-img-top img-fluid img-thumbnail">
                  <div class="card-block">
                    <p class="card-text">扫一扫，让我有更多的时间完善这款软件。</p>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="card">
                  <header class="card-header">
                    支付宝
                  </header>
                  <img src="img/zhifubao-qrcode.jpg" class="card-img-top img-fluid img-thumbnail">
                  <div class="card-block">
                    <p class="card-text">扫一扫，拥有更强的功能，更多的模板。</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<div class="modal fade" id="publish-modal" tabindex="-1" role="dialog" aria-labelledby="#publish-modal-label" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="publish-modal-label">发布网站</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="关闭" v-if="!isProgress || isSuccess">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <template>
          <p>将网站内容发布成静态网页，稍后您可以将其上传，更新网站。</p>
          <div class="text-xs-center" id="upload-progress-label" v-if="isProgress">当前进度：{{label}}</div>
          <progress class="progress" :value="progress" max="100" aria-describedby="#publish-progress-label" v-if="isProgress"></progress>
          <p>
            <button type="button" class="btn btn-lg btn-block" @click="start" :disabled="isProgress || isSuccess" :class="isSuccess ? 'btn-success' : 'btn-primary'">
              <template v-if="isAwait">
                <i class="fa fa-play"></i> 开始发布
              </template>
              <template v-else>
                <template v-if="isSuccess">
                  <i class="fa fa-check"></i> 发布完成
                </template>
                <template v-else>
                  <i class="fa fa-times"></i> 发布失败
                </template>
              </template>
            </button>
          </p>
        </template>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="upload-modal" tabindex="-1" role="dialog" aria-labelledby="#upload-modal-label" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">上传到网站</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="关闭">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <template>
          <p>将已生成的网页上传到服务器。这个操作会需要很长时间，请不要打断程序执行，以免发生错误。</p>
          <div class="text-xs-center" id="publish-progress-label" v-if="isProgress">当前进度：{{label}}</div>
          <progress class="progress" :value="progress" max="100" aria-describedby="#publish-progress-label" v-if="isProgress"></progress>
          <p class="well" v-if="isProgress">
            <template v-for="message in messages">
              {{message}}<br>
            </template>
          </p>
          <p>
            <button type="button" class="btn btn-lg btn-block" @click="start" :disabled="isProgress || isSuccess" :class="isSuccess ? 'btn-success' : 'btn-primary'">
              <template v-if="isAwait">
                <i class="fa fa-cloud-upload"></i> 开始上传
              </template>
              <template v-else>
                <template v-if="isSuccess">
                  <i class="fa fa-check"></i> 上传完成
                </template>
                <template v-else>
                  <i class="fa fa-times"></i> 上传失败
                </template>
              </template>
            </button>
          </p>
        </template>
      </div>
    </div>
  </div>
</div>

<script>
  if (typeof module === 'object') {
    window.module = module;
    module =undefined;
  }
</script>
<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/tether/dist/js/tether.min.js"></script>
<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="node_modules/vue/dist/vue.min.js"></script>
<script src="node_modules/vue-router/dist/vue-router.min.js"></script>
<script src="node_modules/vuex/dist/vuex.min.js"></script>
<script src="node_modules/moment/min/moment-with-locales.min.js"></script>
<script src="app.js"></script>
<script>
  if (window.module) {
    module = window.module;
  }
</script>
</body>
</html>