<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <title>Meart: a static site builder</title>

  <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/screen.css">
</head>
<body>


<script type="text/x-template" id="home-template">
  <div id="home">
    <aside>
      <router-link to="/articles" class="btn btn-secondary" title="相册">
        作品集
      </router-link>
      <router-link to="/preview" class="btn btn-secondary" title="查看网站">
        查看网站
      </router-link>
      <router-link to="/config" class="btn btn-secondary" title="设置">
        设置
      </router-link>
      <router-link to="/help" class="btn btn-outline-secondary btn-block secondary" title="帮助"><i class="fa fa-question-circle-o fa-2x"></i></router-link>
    </aside>
    <router-view class="container-fluid">

    </router-view>
  </div>
</script>

<script type="text/x-template" id="welcome-template">
  <form class="carousel slide welcome-panel" data-ride="carousel" data-interval="0" data-keyboard="false" id="welcome-wizard" @submit.prevent="onSubmit">
    <div class="carousel-inner" role="listbox">
      <div class="carousel-item active">
        <section>
          <h1>欢迎使用 Meart</h1>
          <p>Meart 是一个免费工具，试图帮助设计师、摄影师快捷方便的创建个人作品网站。Meart 尽量将技术细节隐藏起来，所有过程均通过图形界面操作来实现。最终网站托管在免费 CDN 上。</p>
          <p>接下来，请跟随向导指引，完成网初始化。</p>
        </section>
        <footer>
          <a href="#welcome-wizard" data-slide="next" role="button" class="btn btn-primary btn-lg carousel-control" tabindex="0">开始创建网站</a>
        </footer>
      </div>
      <div class="carousel-item info">
        <fieldset>
          <legend>基本信息</legend>
          <div class="form-group">
            <input class="form-control" name="site-title" id="site-title" placeholder="网站名称，比如“我的作品”" v-model="siteTitle" tabindex="1">
          </div>
          <div class="form-group">
            <textarea class="form-control" name="site-desc" id="site-desc" rows="3" placeholder="网站描述，在某些主题中会显示，主要用作被搜索时展示" v-model="siteDesc" tabindex="2">
            </textarea>
          </div>
          <div class="form-group">
            <p class="help-block" v-if="siteIcon">
              <img class="rounded img-thumbnail" :src="siteIcon" width="80" height="80">
            </p>
            <input type="file" class="hide" id="site-icon" @change="onSelectFile">
            <label class="btn btn-secondary" for="site-icon" tabindex="3">
              网站图标
            </label>
            <span class="text-muted"><small>（png，ico 格式，可选）</small></span>
          </div>
        </fieldset>
        <footer>
          <a href="#welcome-wizard" data-slide="next" role="button" class="btn btn-primary btn-lg carousel-control" tabindex="4">下一步</a>
        </footer>
      </div>
      <div class="carousel-item">
        <fieldset>
          <legend>选择模板</legend>
          <div class="form-group row theme-list">
            <div class="col-sm-4">
              <input type="radio" name="site-theme" value="default" id="theme-default" class="hide" v-model="siteTheme">
              <label class="card" for="theme-default">
                <img class="card-img" src="theme/default/img/thumbnail.svg" alt="默认主题">
                <div class="card-img-overlay">
                  <h4>默认主题</h4>
                  <p class="card-text">仅供测试使用。</p>
                </div>
              </label>
            </div>
            <div class="col-sm-4">
              <input type="radio" name="site-theme" value="dark" id="theme-dark" class="hide" v-model="siteTheme">
              <label class="card" for="theme-dark">
                <img class="card-img" src="theme/dark/img/thumbnail.svg" alt="黑色主题">
                <div class="card-img-overlay">
                  <h4>黑色主题</h4>
                  <p class="card-text">内容较完整，建议选择。</p>
                </div>
              </label>
            </div>
          </div>
        </fieldset>
        <footer>
          <button class="btn btn-primary btn-lg">开始</button>
        </footer>
      </div>
    </div>
  </form>
</script>

<script type="text/x-template" id="preview-template">
  <div id="preview">
    <header class="row">
      <h2>预览网站</h2>
      <p class="text-muted">上次生成时间：<time :datetime="publishTime | toDate" v-if="publishTime">{{publishTime | toMoment}}</time>
        <span class="badge badge-success" v-if="publishTime > lastModifiedTime"><i class="fa fa-check"></i> 最新</span><br>
        最近修改时间：<time :datetime="lastModifiedTime | toDate" v-if="lastModifiedTime">{{lastModifiedTime | toMoment}}</time>
      </p>
      <div class="button-group" role="group" aria-label="发布操作">
        <a href="#publish-modal" class="btn btn-outline-primary" data-toggle="modal">发布网站</a>
        <a href="#upload-modal" class="btn btn-outline-success" :data-toggle="hasUpload ? 'modal' : ''" :class="{disabled: !hasUpload}">上传到服务器</a>
      </div>
    </header>
    <nav class="navbar navbar-light bg-faded row" v-if="publishTime">
      <form class="form-inline float-left">
        <button type="button" class="btn btn-secondary" @click="goBack"><i class="fa fa-chevron-left"></i></button>
        <button type="button" class="btn btn-secondary" @click="refresh"><i class="fa fa-refresh"></i></button>
      </form>
    </nav>
    <div class="row">
      <iframe src="output/index.html" v-if="publishTime" :height="height"></iframe>
    </div>
    <div class="alert alert-warning" v-else>
      <p>您还没有生成过网站页面，无法提供预览效果。</p>
      <a href="#publish-modal" class="btn btn-primary btn-lg" data-toggle="modal"><i class="fa fa-archive"></i> 立刻发布网站</a>
    </div>
  </div>
</script>

<script type="text/x-template" id="config-template">
  <div id="config">
    <header class="row">
      <h2>设置</h2>
    </header>
    <ul class="nav nav-tabs row" role="tablist">
      <li class="nav-item">
        <a href="#site-config" class="nav-link active" data-toggle="tab" role="tab">
          网站信息
        </a>
      </li>
      <li class="nav-item">
        <a href="#site-server" class="nav-link" data-toggle="tab" role="tab">
          服务器信息
        </a>
      </li>
    </ul>
    <div class="row">
      <div class="tab-content">
        <div id="site-config" class="tab-pane active"role="tabpanel">
          <div class="settings">
            <form>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="site-title">网点名称</label>
                <div class="col-sm-10">
                  <input class="form-control" id="site-title" v-model="config.siteTitle">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="site-desc">网站简介</label>
                <div class="col-sm-10">
                  <textarea class="form-control" id="site-desc" v-model="config.siteDesc" rows="2"></textarea>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label" for="site-icon">网站图标</label>
                <div class="col-sm-4">
                  <img v-if="config.siteIcon" :src="config.siteIcon" class="img-thumbnail site-icon">
                  <label class="btn btn-secondary">
                    <input type="file" @change="onSelectFile" class="hide">
                    重新上传
                  </label>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-sm-2 col-form-label">网站模板</label>
                <div class="col-sm-10">
                  <div class="row theme-list">
                    <div class="col-sm-3" v-for="theme in themes">
                      <input type="radio" name="site-theme" class="hide" v-model="config.siteTheme" :value="theme.dir" :id="'theme-' + theme.dir">
                      <label class="card" :for="'theme-' + theme.dir">
                        <img class="card-img img-fluid" :src="'theme/' + theme.dir + '/' + theme.thumbnail" alt="默认模板" v-if="theme.thumbnail">
                        <div class="card-img-overlay">
                          <h4 class="card-title">{{theme.name}}</h4>
                          <p class="card-text">{{theme.description}}</p>
                        </div>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div id="site-server" class="tab-pane" role="tabpanel">
          <form @submit.prevent="saveServerSettings" >
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="server-name">服务器名称</label>
              <div class="col-sm-10">
                <select class="form-control" id="server-name" v-model="server.name">
                  <option value="qiniu">七牛</option>
                </select>
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="ACCESS_KEY">Access Key</label>
              <div class="col-sm-10">
                <input type="password" class="form-control" id="access_key" v-model="server.ACCESS_KEY">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="SECRET_KEY">Secret Key</label>
              <div class="col-sm-10">
                <input type="password" class="form-control" id="secret_key" v-model="server.SECRET_KEY">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="bucket">存放空间</label>
              <div class="col-sm-10">
                <input class="form-control" id="bucket" v-model="server.bucket">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-sm-2 col-form-label" for="host">域名</label>
              <div class="col-sm-10">
                <input class="form-control" id="host" v-model="server.host">
                <p class="form-text text-muted">用于刷新 CDN 缓存，请包含 <code>http://</code> 或者 <code>https://</code>，以 <code>/</code> 结束。</p>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</script>

<script type="text/x-template" id="article-list-template">
  <div id="article-list" class="article-list article">
    <h2 class="row">我的作品集</h2>
    <ul class="list row">
      <li v-for="article in isVisible(articles)" class="col-sm-4 single-article">
        <a :href="getHref(article.id)" class="card">
          <img class="card-img-top img-fluid" :src="article.thumbnail" :alt="article.title" v-if="article.thumbnail">
          <div class="card-block">
            <h4 class="card-title">{{article.title}}</h4>
            <p class="card-text">{{article.description}}</p>
            <small class="text-muted">创建时间：<time :datetime="article.createTime | toDate">{{article.createTime | toMoment}}</time></small><br>
            <small class="text-muted">最后修改：<time :datetime="article.lastModifiedTime | toDate">{{article.lastModifiedTime | toMoment}}</time></small>
            <span class="status badge" :class="article.status ? 'badge-default' : 'badge-success'">{{article.status ? '草稿' : '已发布'}}</span>
          </div>
        </a>
      </li>
      <li class="article add col-sm-4">
        <button type="button" class="btn btn-secondary btn-block" v-on:click="add">
          <i class="fa fa-plus fa-4x"></i>
          <br>
          <span class="caption">新建作品集</span>
        </button>
      </li>
    </ul>
  </div>
</script>

<script type="text/x-template" id="article-template">
  <article class="single article">
    <template>
      <header class="row">
        <div class="col-sm-4 thumbnail">
          <input type="file" class="hide" id="article-thumbnail" @change="onSelectThumbnail">
          <label for="article-thumbnail">
            <img :src="article.thumbnail | defaultValue('thumbnail')" class="img-thumbnail"  :class="thumbnail" @dragend.prevent="thumbnail_onDragEnd" @dragenter="thumbnail_onDragEnter" @dragexit="thumbnail_onDragExit">
          </label>
        </div>
        <div class="col-sm-5">
          <editor :origin-value="article.title" @change="onEditorChange('title', $event)">
            <h1>{{article.title | defaultValue('title')}}</h1>
          </editor>
          <editor :origin-value="article.description" @change="onEditorChange('description', $event)">
            <p>{{article.description | defaultValue('description')}}</p>
          </editor>
          <editor :origin-value="article.url" @change="onEditorChange('url', $event)">
            <p>
              <u><small class="text-muted">{{host}}</small>{{article.url | defaultValue('url')}}<small class="text-muted">.html</small></u>
            </p>
          </editor>
          <editor :origin-value="article.tags" @change="onEditorChange('tags', $event)">
            <p>{{article.tags | defaultValue('tags')}}</p>
          </editor>
          <p class="text-muted">
            <small>创建时间：<time :datetime="article.createTime | toDate">{{article.createTime | toMoment}}</time></small> |
            <small>修改时间：<time :datetime="article.lastModifiedTime | toDate">{{article.lastModifiedTime | toMoment}}</time></small>
          </p>
        </div>
        <div class="col-sm-2 offset-sm-1">
          <div class="form-group row form-inline">
            <label for="draft" class="col-sm-4">状态：</label>
            <select v-model.number="article.status" id="draft" class="form-control fa col-sm-8" :class="publishedClass" :disabled="isNew">
              <option value="0" class="fa-check">&#xf00c 发布</option>
              <option value="1">草稿</option>
            </select>
          </div>
        </div>
      </header>
      <ul class="row list album">
        <li v-for="(photo, index) in article.album" class="col-sm-4 photo" :class="{ active: photo.isActive }">
          <div class="card">
            <button type="button" class="btn btn-sm btn-secondary delete-button" @click="removePhoto(index)">
              <i class="fa fa-trash"></i>
            </button>
            <img class="card-img-top img-fluid" :src="photo.src" :alt="photo.title" @load="onPhotoLoad($event, index)">
            <div class="card-block">
              <editor :origin-value="photo.title" @change="onPhotoChange('title', index, $event)">
                <h4 class="card-title">{{photo.title}}</h4>
              </editor>
              <editor :origin-value="photo.title" @change="onPhotoChange('description', index, $event)">
                <p class="card-text">{{photo.description}}</p>
              </editor>
            </div>
          </div>
        </li>
        <li class="col-sm-4 add" :class="addButton" @dragenter="addButton_onDragEnter" @dragexit="addButton_onDragExit" @dragend.prevent="addButton_onDragEnd">
          <label class="btn btn-secondary btn-block">
            <i class="fa fa-plus fa-4x"></i>
            <br>
            <span class="caption">添加新作品</span>
            <input type="file" accept="image/*" @change="onSelectFile" multiple>
          </label>
        </li>
      </ul>
    </template>
  </article>
</script>

<script type="text/x-template" id="editor">
<div class="dbl-click-editor" v-bind:class="{ editing: isEditing }" @dblclick="edit">
  <slot></slot>
  <input class="form-control" v-model="value" @blur="editDone" @keyup.enter.prevent="editDone" @keyup.esc="cancel" autofocus>
</div>
</script>

<script type="text/x-template" id="help-template">
  <div id="help">
    <header class="row">
      <h2>帮助</h2>
    </header>
    <ul class="nav nav-tabs row" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" role="tab" href="#help-detail">帮助</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" role="tab" href="#help-about">关于</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" role="tab" href="#help-author">作者</a>
      </li>
    </ul>
    <div class="row">
      <div class="tab-content">
        <div class="tab-pane active" id="help-detail" role="tabpanel">
          <article v-html="tutorial">

          </article>
        </div>
        <div class="tab-pane" id="help-about" role="tabpanel">
          <article v-html="about"></article>
          <h3>当前版本：</h3>
          <p>{{version}}</p>
        </div>
        <div class="tab-pane" id="help-author" role="tabpanel">
          <div class="row">
            <article class="col-sm-6">
              <h3>你好，我是 Meart 的开发者 Meathill</h3>
              <p>
                <img :src="avatar" @click="easter" class="img-thumbnail card-img-top">
              </p>
              <article v-html="author"></article>
            </article>
            <article class="col-sm-6">
              <h3>如果觉得 Meart 不错，<br>请我喝杯咖啡吧</h3>
              <div class="row">
                <div class="col-sm-6">
                  <img src="img/weixin-qrcode.jpg" class="card-img-top img-fluid img-thumbnail">
                  <p class="t-a-c">微信支付</p>
                </div>
                <div class="col-sm-6">
                  <img src="img/zhifubao-qrcode.jpg" class="card-img-top img-fluid img-thumbnail">
                  <p class="t-a-c">支付宝支付</p>
                </div>
              </div>
              <p class="lead">
                您的支持是我坚持下去的动力，<br>
                THANK YOU All！
              </p>
            </article>
          </div>
        </div>
      </div>
    </div>
  </div>
</script>

<div class="modal fade" id="publish-modal" tabindex="-1" role="dialog" aria-labelledby="#publish-modal-label" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="publish-modal-label">发布网站</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="关闭" v-if="!isProgress || isSuccess">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <template>
          <p>将网站内容发布成静态网页，稍后您可以将其上传，更新网站。</p>
          <div class="text-xs-center" id="upload-progress-label" v-if="isProgress">当前进度：{{label}}</div>
          <progress class="progress" :value="progress" max="100" aria-describedby="#publish-progress-label" v-if="isProgress"></progress>
          <p>
            <button type="button" class="btn btn-lg btn-block" @click="start" :disabled="isProgress || isSuccess" :class="isSuccess ? 'btn-success' : 'btn-primary'">
              <template v-if="isAwait">
                <i class="fa fa-play"></i> 开始发布
              </template>
              <template v-else-if="isProgress">
                <i class="fa fa-spin fa-spinner"></i> 正在发布
              </template>
              <template v-else>
                <template v-if="isSuccess">
                  <i class="fa fa-check"></i> 发布完成
                </template>
                <template v-else>
                  <i class="fa fa-times"></i> 发布失败
                </template>
              </template>
            </button>
          </p>
        </template>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="upload-modal" tabindex="-1" role="dialog" aria-labelledby="#upload-modal-label" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">上传到网站</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="关闭">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <template>
          <p>将已生成的网页上传到服务器。这个操作会需要很长时间，请不要打断程序执行，以免发生错误。</p>
          <p><small class="text-muted">注：七牛 CDN 刷新时间为 10 分钟，即上传 10 分钟后，网站内容才会变化。</small></p>
          <p v-if="result" v-html="result" class="alert" :class="isSuccess ? 'alert-success' : 'alert-danger'"></p>
          <div class="text-xs-center" id="publish-progress-label" v-if="isProgress">当前进度：{{label}}</div>
          <progress class="progress" :value="progress" max="100" aria-describedby="#publish-progress-label" v-if="isProgress"></progress>
          <p class="well" v-if="isProgress">
            <template v-for="message in messages">
              {{message}}<br>
            </template>
          </p>
          <p>
            <button type="button" class="btn btn-lg btn-block" @click="start" :disabled="isProgress || isSuccess" :class="isSuccess ? 'btn-success' : 'btn-primary'">
              <template v-if="isAwait">
                <i class="fa fa-cloud-upload"></i> 开始上传
              </template>
              <template v-else-if="isProgress">
                <i class="fa fa-spinner fa-spin"></i> 上传中
              </template>
              <template v-else>
                <template v-if="isSuccess">
                  <i class="fa fa-check"></i> 上传完成
                </template>
                <template v-else>
                  <i class="fa fa-times"></i> 上传失败
                </template>
              </template>
            </button>
          </p>
        </template>
      </div>
    </div>
  </div>
</div>

<script>
  if (typeof module === 'object') {
    window.module = module;
    module =undefined;
  }
</script>
<script src="node_modules/vue/dist/vue.min.js"></script>
<script src="node_modules/vue-router/dist/vue-router.min.js"></script>
<script src="node_modules/vuex/dist/vuex.min.js"></script>
<script src="node_modules/moment/min/moment-with-locales.min.js"></script>
<script src="dist/app.js"></script>
<script>
  if (window.module) {
    module = window.module;
  }
</script>
</body>
</html>